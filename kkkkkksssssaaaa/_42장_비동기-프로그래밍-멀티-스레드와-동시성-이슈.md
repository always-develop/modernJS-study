# _42장. 비동기 프로그래밍-멀티 스레드와 동시성 이슈

# [javascript] ☕ 모던 자바스크립트

---

## _42장. 비동기 프로그래밍-멀티 스레드와 동시성 이슈

### I/O

- Input / Output
- 모든 컴퓨터는 `파일` 로 이루어져있다
    - 데이터베이스도 `파일 시스템` 으로의 접근을 추상화한 프로그램
    - 심지어는 HTTP 통신조차 파일을 통해 이루어진다!
- 모든 컴퓨팅 연산은 `입력` 과 `출력` 을 수행한다
- 이러한 특징 때문에 I/O 작업을 수행할 경우 `동시에 한 파일에 여러 입력이 접근할 때(동시성 이슈)` 에 대한 대비를 해야 한다
    - 동시에 접근해야만하는 파일이라면?
    - 동시에 접근할 수 없는 파일이라면, 어떻게 접근을 막을 것인가?
    - A 입력을 수행하는 동시에 B 입력도 수행 중일 때, B 의 입력이 종료되면 A 의 입력 사항은 어떻게 반영 되는가?
    - 위와 같은 동시성 이슈는 보통 한 번의 입력이 유효하도록 `다른 입력을 잠그는(Lock)` 방식으로 대비
- 동시성 처리에 대한 이슈는 일반적인 파일 I/O 외에도 멀티스레딩 환경, 멀티코어 환경, 서버 측면에서의 HTTP Request 처리 방법 등 다양한 어플리케이션 환경에서도 쉽게 마주할 수 있는 이슈

### 운영체제가 명령을 처리하는 방법

- 프로세스란?
    
    ![process.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/762072f1-a0fe-4026-b488-c71e72f2f304/process.png)
    
    - 파일시스템에 존재하던 파일(프로그램)이 컴퓨터 자원을 할당받은 상태, 즉 실행 중인 프로그램을 `프로세스` 라고 함
    - 윈도우 시스템에서 로컬 파일을 열었을 때 작업 관리자의 프로세스 탭에서 확인할 수 있는 것처럼, 실행 중인 프로그램을 프로세스라고 표현
    - 컴퓨터 자원(주로 CPU, RAM)은 프로세스를 기준으로 할당 됨
- 프로세스의 메모리 구조
    
    ![img_c_memory_structure.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/95132276-8246-4627-8c84-db29633de4e5/img_c_memory_structure.png)
    
    - 메모리 영역은 논리적인 네 개의 영역으로 나뉘어져 있음
    - `코드 영역` 에서는 프로그램 코드를 저장하며
    - `데이터 영역` 에서는 해당 프로그램에서 사용되는 전역 변수들이 저장되며
        - e.g. C 언어나 자바의 `static` 키워드로 선언한 변수들은 프로세스가 실행되는 순간부터 메모리에 계속 존재하게 됨
    - `힙 영역` 은 주로 클래스의 인스턴스가 저장됨
        - e.g. 자바의 클래스 인스턴스
    - `스택 영역` 은 지역 변수나 매개 변수처럼 함수 단위마다 존재하는 데이터들이 저장됨
- 스레드란?
    
    ![thread.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/354bbca3-2c20-49eb-bff3-3b40335897e3/thread.png)
    
    - 프로세스가 명령을 처리할 수 있는 여러 흐름들에 대한 단위
    - 스레드 덕에 프로세스는 여러 개의 작업을 **동시에 처리할 수 있는 것처럼** 보이게 할 수 있음
        - 실제로 CPU 는 현재 할당 되어 있는 프로세스의 단 한 개의 명령만 순차적으로 수행할 수 있음
- 공유 자원
    - 스레드의 고유 자원은 오로지 `스택` 만  가질 뿐, 코드, 데이터 힙 영역의 데이터는 모드 프로세스의 자원을 `공유`

### 그래서, 동시성이 뭔데

- 결국 동시성이란, 멀티스레딩 환경에서 여러 스레드가 힙 영역에 존재하는 데이터에 접근하게 될 때 발생할 수 있는 모든 이슈 를 뜻함
- `잠금` 이라는 용어도 힙 영역의 데이터 A 에 대해 Thread1 이 해당 자원을 사용하고 있을 경우, 그 외 다른 스레드가 A 에 접근하지 못하도록 제한하는 행위를 뜻함

### 참고 링크

- [컴퓨터 구조를 통해 이해하는 파일과 소켓](https://velog.io/@hidaehyunlee/컴퓨터-구조를-통해-이해하는-파일File과-소켓Socket)
- [뮤텍스와 세마포어의 차이](https://worthpreading.tistory.com/90)
- [코어와 스레드의 개념이 헷갈립니다.ㅠㅠ](https://quasarzone.com/bbs/qf_cmr/views/12864)